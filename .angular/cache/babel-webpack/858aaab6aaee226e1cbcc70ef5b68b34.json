{"ast":null,"code":"import { FormControl, FormGroup, Validators } from \"@angular/forms\";\nimport { ColorPickerComponent } from \"../../../custom-modules/color-picker/color-picker.component\";\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../../../services/album.service\";\nimport * as i2 from \"../../../services/photo.service\";\nimport * as i3 from \"@angular/router\";\nimport * as i4 from \"@angular/material/dialog\";\nimport * as i5 from \"@angular/material/card\";\nimport * as i6 from \"@angular/forms\";\nimport * as i7 from \"@angular/material/input\";\nimport * as i8 from \"@angular/material/button\";\nimport * as i9 from \"@angular/common\";\nimport * as i10 from \"@angular/material/icon\";\nimport * as i11 from \"src/app/components/albums/album-photos/album-photos.component\";\n\nconst _c0 = function (a0) {\n  return {\n    backgroundColor: a0\n  };\n};\n\nexport let EditAlbumComponent = /*#__PURE__*/(() => {\n  class EditAlbumComponent {\n    constructor(albumService, photoService, router, route, dialog) {\n      this.albumService = albumService;\n      this.photoService = photoService;\n      this.router = router;\n      this.route = route;\n      this.dialog = dialog;\n      this.isCreation = true;\n      this.album = {\n        backgroundColor: 'mediumblue',\n        photos: []\n      };\n    }\n\n    ngOnInit() {\n      this.albumCreationForm = new FormGroup({\n        name: new FormControl(null, Validators.required),\n        description: new FormControl(null, Validators.required)\n      });\n      this.route.params.subscribe(params => {\n        if (+params['id']) {\n          this.albumService.getAlbum(+params['id']).subscribe(album => {\n            this.album = album;\n            this.albumCreationForm.get('name').setValue(this.album.name);\n            this.albumCreationForm.get('description').setValue(this.album.description);\n          });\n        }\n      });\n    }\n\n    onSaveAlbum() {\n      this.album.name = this.albumCreationForm.get('name').value;\n      this.album.description = this.albumCreationForm.get('description').value;\n\n      if (this.album.id) {\n        this.albumService.updateAlbum(this.album).subscribe(savedAlbum => {\n          for (let i = 0; i < this.album.photos.length; i++) {\n            let image = this.album.photos[i];\n\n            if (!image.id) {\n              image.album = savedAlbum;\n              image.description = savedAlbum.description;\n              this.photoService.uploadPhoto(image).subscribe(value => {});\n            }\n\n            if (i == this.album.photos.length - 1) {\n              this.albumCreationForm.reset();\n              this.router.navigate(['../'], {\n                relativeTo: this.route\n              }).then(() => {\n                window.location.reload();\n              });\n            }\n          }\n        });\n      } else {\n        this.albumService.createAlbum(this.album).subscribe(savedAlbum => {\n          for (let i = 0; i < this.album.photos.length; i++) {\n            let image = this.album.photos[i];\n            image.album = savedAlbum;\n            image.description = savedAlbum.description;\n            this.photoService.uploadPhoto(image).subscribe(value => {\n              if (i == this.album.photos.length - 1) {\n                this.albumCreationForm.reset();\n                this.router.navigate(['../'], {\n                  relativeTo: this.route\n                }).then(() => {\n                  window.location.reload();\n                });\n              }\n            });\n          }\n        });\n      }\n    }\n\n    onPickColor() {\n      let dialogRef = this.dialog.open(ColorPickerComponent);\n      dialogRef.afterClosed().subscribe(result => {\n        if (result) {\n          this.album.backgroundColor = result;\n        }\n      });\n    }\n\n    onClose() {\n      this.router.navigate(['../'], {\n        relativeTo: this.route\n      });\n    }\n\n  }\n\n  EditAlbumComponent.ɵfac = function EditAlbumComponent_Factory(t) {\n    return new (t || EditAlbumComponent)(i0.ɵɵdirectiveInject(i1.AlbumService), i0.ɵɵdirectiveInject(i2.PhotoService), i0.ɵɵdirectiveInject(i3.Router), i0.ɵɵdirectiveInject(i3.ActivatedRoute), i0.ɵɵdirectiveInject(i4.MatDialog));\n  };\n\n  EditAlbumComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: EditAlbumComponent,\n    selectors: [[\"app-edit-album\"]],\n    decls: 28,\n    vars: 6,\n    consts: [[2, \"background-color\", \"darkgrey\"], [3, \"formGroup\", \"ngSubmit\"], [1, \"form-group\"], [\"for\", \"name\"], [\"type\", \"text\", \"id\", \"name\", \"formControlName\", \"name\", 1, \"form-control\"], [\"for\", \"description\"], [\"id\", \"description\", \"formControlName\", \"description\", \"matInput\", \"\", \"placeholder\", \"My vacation in France ...\", 1, \"form-control\"], [\"type\", \"button\", \"mat-raised-button\", \"\", 2, \"margin-top\", \"5px\", 3, \"ngStyle\", \"click\"], [3, \"album\"], [\"type\", \"submit\", 1, \"btn\", \"btn-primary\", 2, \"margin-top\", \"5px\"], [\"type\", \"button\", 1, \"btn\", \"btn-danger\", 2, \"margin-top\", \"5px\", \"margin-left\", \"5px\", 3, \"click\"]],\n    template: function EditAlbumComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementStart(0, \"div\");\n        i0.ɵɵelementStart(1, \"mat-card\", 0);\n        i0.ɵɵelementStart(2, \"mat-card-header\");\n        i0.ɵɵelementStart(3, \"mat-card-title\");\n        i0.ɵɵelementStart(4, \"p\");\n        i0.ɵɵtext(5);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(6, \"mat-card-content\");\n        i0.ɵɵelementStart(7, \"form\", 1);\n        i0.ɵɵlistener(\"ngSubmit\", function EditAlbumComponent_Template_form_ngSubmit_7_listener() {\n          return ctx.onSaveAlbum();\n        });\n        i0.ɵɵelementStart(8, \"div\", 2);\n        i0.ɵɵelementStart(9, \"label\", 3);\n        i0.ɵɵtext(10, \"Name\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelement(11, \"input\", 4);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(12, \"div\", 2);\n        i0.ɵɵelementStart(13, \"label\", 5);\n        i0.ɵɵtext(14, \"Description\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(15, \"textarea\", 6);\n        i0.ɵɵtext(16, \"          \");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(17, \"div\", 2);\n        i0.ɵɵelementStart(18, \"button\", 7);\n        i0.ɵɵlistener(\"click\", function EditAlbumComponent_Template_button_click_18_listener() {\n          return ctx.onPickColor();\n        });\n        i0.ɵɵelementStart(19, \"mat-icon\");\n        i0.ɵɵtext(20, \"color_lens\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(21, \"div\");\n        i0.ɵɵelement(22, \"app-album-photos\", 8);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(23, \"button\", 9);\n        i0.ɵɵtext(24, \"Create Album\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(25, \"button\", 10);\n        i0.ɵɵlistener(\"click\", function EditAlbumComponent_Template_button_click_25_listener() {\n          return ctx.onClose();\n        });\n        i0.ɵɵtext(26, \"close\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelement(27, \"mat-card-footer\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n      }\n\n      if (rf & 2) {\n        i0.ɵɵadvance(5);\n        i0.ɵɵtextInterpolate1(\" \", ctx.albumCreationForm.get(\"name\").value, \" \");\n        i0.ɵɵadvance(2);\n        i0.ɵɵproperty(\"formGroup\", ctx.albumCreationForm);\n        i0.ɵɵadvance(11);\n        i0.ɵɵproperty(\"ngStyle\", i0.ɵɵpureFunction1(4, _c0, ctx.album.backgroundColor));\n        i0.ɵɵadvance(4);\n        i0.ɵɵproperty(\"album\", ctx.album);\n      }\n    },\n    directives: [i5.MatCard, i5.MatCardHeader, i5.MatCardTitle, i5.MatCardContent, i6.ɵNgNoValidate, i6.NgControlStatusGroup, i6.FormGroupDirective, i6.DefaultValueAccessor, i6.NgControlStatus, i6.FormControlName, i7.MatInput, i8.MatButton, i9.NgStyle, i10.MatIcon, i11.AlbumPhotosComponent, i5.MatCardFooter],\n    styles: [\"\"]\n  });\n  return EditAlbumComponent;\n})();","map":null,"metadata":{},"sourceType":"module"}